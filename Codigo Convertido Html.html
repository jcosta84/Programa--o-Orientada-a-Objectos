<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gest√£o de Clientes ‚Äî Interface HTML (Op√ß√£o B)</title>

  <style>
    :root{
      --bg:#f7fafc;
      --card:#ffffff;
      --muted:#6b7280;
      --accent:#2563eb;
    }

    body{
      font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      margin:0;
      background:var(--bg);
      color:#111827;
    }

    /* --- LAYOUT PRINCIPAL EM DUAS COLUNAS --- */
    .container{
      display:flex;
      gap:20px;
      padding:20px;
    }

    /* --- SIDEBAR / MENU LATERAL --- */
    nav{
      display:flex;
      flex-direction:column;
      gap:10px;
      width:220px;
    }

    .tab{
      background:var(--card);
      padding:12px;
      border-radius:8px;
      cursor:pointer;
      border:1px solid #e6e9ee;
      width:100%;
      text-align:left;
      transition:0.2s;
    }

    .tab:hover{
      background:#eef2ff;
    }

    .tab.active{
      box-shadow:0 6px 18px rgba(15,23,42,0.06);
      border-color:var(--accent);
    }

    /* --- √ÅREA DE CONTE√öDO --- */
    .content{
      flex:1;
      max-width:1000px;
      margin-left: 40px; 
    }

    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
    }

    header h1{
      margin:0;
      font-size:20px;
    }

    .card{
      background:var(--card);
      padding:16px;
      border-radius:10px;
      box-shadow:0 6px 18px rgba(15,23,42,0.04);
      margin-top:14px;
    }

    label{
      display:block;
      margin-top:10px;
      font-size:14px;
    }

    input[type=text], input[type=email], input[type=file], textarea, select{
      width:100%;
      padding:8px;
      border-radius:8px;
      border:1px solid #e6e9ee;
    }

    button{
      background:var(--accent);
      color:#fff;
      padding:10px 14px;
      border-radius:8px;
      border:0;
      cursor:pointer;
      margin-top:10px;
    }

    .row{ display:flex; gap:12px; }
    .col{ flex:1; }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:12px;
    }

    th, td{
      padding:8px;
      border-bottom:1px solid #f1f5f9;
      text-align:left;
    }

    .muted{ color:var(--muted); }
    .small{ font-size:13px; }
    .success{ color:green; }
    .error{ color:red; }

    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:13px;
    }

    @media(max-width:900px){
      .container{ flex-direction:column; }
      nav{ width:100%; flex-direction:row; overflow-x:auto; }
      .tab{ width:auto; white-space:nowrap; }
    }
  </style>
</head>

<body>
  <div class="container">

    <!-- MENU LATERAL -->
    <nav id="tabs">
      <div class="tab active" data-tab="cadastro">Cadastro</div>
      <div class="tab" data-tab="cc">Para Conhecimento (CC)</div>
      <div class="tab" data-tab="consultar">Consultar Cadastro</div>
      <div class="tab" data-tab="envio">Envio de E-mails</div>
      <div class="tab" data-tab="relatorio">Relat√≥rio</div>
    </nav>

    <!-- CONTE√öDO PRINCIPAL -->
    <div class="content">

      <header>
        <h1>üìß Gest√£o de Clientes ‚Äî Interface HTML (Op√ß√£o B)</h1>
        <div class="small muted">Modo: Frontend est√°tico (localStorage)</div>
      </header>

      <!-- Cadastro -->
      <section id="cadastro" class="card">
        <h2>üìã Cadastro de Cliente</h2>
        <form id="formCadastro">
          <div class="row">
            <div class="col">
              <label for="cil">CIL</label>
              <input type="text" id="cil" required />
            </div>
            <div class="col">
              <label for="nome">Nome</label>
              <input type="text" id="nome" required />
            </div>
            <div class="col">
              <label for="email">Email</label>
              <input type="email" id="email" required />
            </div>
          </div>

          <label for="nomePdf">Nome PDF (gerado)</label>
          <input type="text" id="nomePdf" disabled />

          <button type="submit">Cadastrar Cliente</button>
          <div id="msgCadastro" class="small muted"></div>
        </form>
      </section>

      <!-- CC -->
      <section id="cc" class="card" style="display:none">
        <h2>üìã E-mails para Conhecimento (CC)</h2>
        <div>
          <label for="novoCc">Adicionar novo e-mail CC</label>
          <input type="email" id="novoCc" placeholder="exemplo@dominio.com" />
          <button id="btnAddCc">Adicionar CC</button>
        </div>
        <div id="listaCc"></div>
      </section>

      <!-- Consultar -->
      <section id="consultar" class="card" style="display:none">
        <h2>üîé Consultar Cliente</h2>
        <div class="row">
          <div class="col">
            <label for="selCil">Filtrar por CIL</label>
            <select id="selCil" multiple style="height:120px"></select>
            <button id="btnFiltrar">Aplicar Filtro</button>
          </div>
          <div class="col">
            <label>Clientes</label>
            <div id="tabelaClientes"></div>
          </div>
        </div>
      </section>

      <!-- Envio -->
      <section id="envio" class="card" style="display:none">
        <h2>üì§ Envio de E-mails (simula√ß√£o)</h2>
        <p class="muted small">Selecione arquivos PDF (nome deve ser igual ao campo "arquivo_anexo").</p>
        <input type="file" id="pdfs" multiple accept="application/pdf" />
        <button id="btnEnviar">Enviar E-mails (simular)</button>
        <div id="progresso" class="small muted"></div>
      </section>

      <!-- Relat√≥rio -->
      <section id="relatorio" class="card" style="display:none">
        <h2>üìä Relat√≥rio de Envios</h2>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <button id="btnGerarCSV">Exportar CSV</button>
          <button id="btnLimparRel">Limpar Relat√≥rio</button>
        </div>
        <div id="tabelaRelatorio" style="margin-top:12px"></div>
      </section>

      <footer>
        <div class="muted">Esta vers√£o √© um frontend est√°tico ‚Äî para integra√ß√£o com banco de dados utilize a vers√£o Flask (Op√ß√£o C).</div>
      </footer>

    </div>
  </div>

  <!-- SCRIPT ORIGINAL SEM ALTERA√á√ïES -->
  <script>
    const DB_KEYS = {
      CLIENTES: 'app_clientes_v1',
      CC: 'app_cc_v1',
      REL: 'app_relatorio_v1'
    }

    function carregar(k){ return JSON.parse(localStorage.getItem(k) || "[]") }
    function salvar(k,v){ localStorage.setItem(k, JSON.stringify(v)) }

    function init(){
      document.querySelectorAll('#tabs .tab').forEach(t =>
        t.addEventListener('click', ()=>switchTab(t.dataset.tab))
      );

      const form = document.getElementById('formCadastro');
      form.addEventListener('submit', e => { e.preventDefault(); cadastrarCliente() });

      document.getElementById('cil').addEventListener('input', ()=>{
        const c = document.getElementById('cil').value.trim();
        document.getElementById('nomePdf').value = c ? c+'.pdf' : '';
      });

      document.getElementById('btnAddCc').addEventListener('click', addCc);
      document.getElementById('btnFiltrar').addEventListener('click', renderClientes);
      document.getElementById('btnEnviar').addEventListener('click', simularEnvio);
      document.getElementById('btnGerarCSV').addEventListener('click', exportarCSV);

      document.getElementById('btnLimparRel').addEventListener('click', ()=>{
        if(confirm("Limpar relat√≥rio?")){
          salvar(DB_KEYS.REL, []);
          renderRelatorio();
        }
      });

      renderCc(); renderClientes(); renderRelatorio(); renderSelCilOptions();
    }

    function switchTab(tab){
      document.querySelectorAll('section').forEach(s => s.style.display='none');
      document.getElementById(tab).style.display='block';
      document.querySelectorAll('#tabs .tab').forEach(t => t.classList.remove('active'));
      document.querySelector(`#tabs .tab[data-tab="${tab}"]`).classList.add('active');
      if(tab==='consultar') renderClientes();
      if(tab==='relatorio') renderRelatorio();
    }

    /* --------------- L√ìGICA ORIGINAL (sem altera√ß√µes) ---------------- */
    function cadastrarCliente(){
      const cil = cil.value.trim();
      const nome = nome.value.trim();
      const email = email.value.trim();
      const arquivo = cil ? cil+'.pdf' : '';
      const msg = document.getElementById('msgCadastro');

      if(!cil || !nome || !email){
        msg.textContent='Por favor preencha todos os campos.';
        msg.className='error';
        return;
      }

      const clientes = carregar(DB_KEYS.CLIENTES);
      if(clientes.some(c=>c.cil===cil)){
        msg.textContent='Cliente j√° existe.'; msg.className='muted'; return;
      }

      clientes.push({cil,nome,email,arquivo_anexo:arquivo});
      salvar(DB_KEYS.CLIENTES, clientes);
      msg.textContent='Cliente cadastrado!'; msg.className='success';
      formCadastro.reset();
      document.getElementById('nomePdf').value='';
      renderClientes(); renderSelCilOptions();
    }

    function renderClientes(){
      const clientes = carregar(DB_KEYS.CLIENTES);
      const sel = document.getElementById('selCil');
      const selected = Array.from(sel.selectedOptions).map(o=>o.value);
      const filtro = selected.length ? clientes.filter(c=>selected.includes(c.cil)) : clientes;

      let html = "<table><thead><tr><th>CIL</th><th>Nome</th><th>Email</th><th>Anexo</th><th>A√ß√µes</th></tr></thead><tbody>";
      filtro.forEach(c=>{
        html += `<tr>
          <td>${c.cil}</td>
          <td>${c.nome}</td>
          <td>${c.email}</td>
          <td class="small muted">${c.arquivo_anexo}</td>
          <td>
            <button onclick="editarCliente('${c.cil}')">Editar</button>
            <button onclick="excluirCliente('${c.cil}')">Excluir</button>
          </td>
        </tr>`;
      });
      html+="</tbody></table>";

      document.getElementById('tabelaClientes').innerHTML = html;
    }

    function renderSelCilOptions(){
      const sel = document.getElementById('selCil');
      const clientes = carregar(DB_KEYS.CLIENTES);
      sel.innerHTML="";
      clientes.forEach(c=>{
        const o = document.createElement("option");
        o.value=c.cil; o.textContent=c.cil;
        sel.appendChild(o);
      });
    }

    function editarCliente(cil){
      const clientes = carregar(DB_KEYS.CLIENTES);
      const c = clientes.find(x=>x.cil===cil);
      if(!c) return alert("Cliente n√£o encontrado");

      const n = prompt("Nome:", c.nome);
      if(n===null) return;
      const e = prompt("Email:", c.email);
      if(e===null) return;

      c.nome=n; c.email=e;
      salvar(DB_KEYS.CLIENTES,clientes);
      renderClientes(); renderSelCilOptions();
    }

    function excluirCliente(cil){
      if(!confirm("Excluir?")) return;
      let c = carregar(DB_KEYS.CLIENTES);
      c = c.filter(x=>x.cil!==cil);
      salvar(DB_KEYS.CLIENTES,c);
      renderClientes(); renderSelCilOptions();
    }

    function addCc(){
      const email = novoCc.value.trim();
      if(!email) return alert("Insira um e-mail");
      const cc = carregar(DB_KEYS.CC);
      if(cc.includes(email)) return alert("J√° existe");
      cc.push(email); salvar(DB_KEYS.CC, cc);
      novoCc.value=""; renderCc();
    }

    function renderCc(){
      const cc = carregar(DB_KEYS.CC);
      if(!cc.length){
        listaCc.innerHTML = '<div class="muted small">Nenhum e-mail CC cadastrado.</div>';
        return;
      }
      let html = "<table><thead><tr><th>E-mail CC</th><th>A√ß√µes</th></tr></thead><tbody>";
      cc.forEach((e,i)=>{
        html += `<tr><td>${e}</td><td><button onclick="remCc(${i})">Remover</button></td></tr>`;
      });
      html+="</tbody></table>";
      listaCc.innerHTML = html;
    }

    function remCc(i){
      const cc = carregar(DB_KEYS.CC);
      cc.splice(i,1);
      salvar(DB_KEYS.CC,cc);
      renderCc();
    }

    async function simularEnvio(){
      const arquivos = pdfs.files;
      if(!arquivos.length) return alert("Selecione PDFs");
      const clientes = carregar(DB_KEYS.CLIENTES);
      if(!clientes.length) return alert("Nenhum cliente");

      const map={};
      for(const f of arquivos) map[f.name]=f;

      const rel = carregar(DB_KEYS.REL);
      const cc = carregar(DB_KEYS.CC);

      let enviados=0;

      for(const c of clientes){

        if(c.arquivo_anexo && map[c.arquivo_anexo]){
          rel.unshift({
            nome:c.nome, email:c.email, cil:c.cil,
            status:"Sucesso", mensagem:"Simula√ß√£o: enviado",
            data_envio:new Date().toISOString(), cc
          });
          enviados++;
        } else {
          rel.unshift({
            nome:c.nome, email:c.email, cil:c.cil,
            status:"Pendente", mensagem:"Arquivo n√£o encontrado",
            data_envio:new Date().toISOString(), cc
          });
        }

        progresso.textContent = `Processados: ${enviados} / ${clientes.length}`;
        await new Promise(r=>setTimeout(r,200));
      }

      salvar(DB_KEYS.REL, rel);
      renderRelatorio();
      alert("Envio conclu√≠do!");
    }

    function renderRelatorio(){
      const rel = carregar(DB_KEYS.REL);
      if(!rel.length){
        tabelaRelatorio.innerHTML = '<div class="muted small">Sem entradas no relat√≥rio.</div>';
        return;
      }

      let html = "<table><thead><tr><th>Nome</th><th>Email</th><th>CIL</th><th>Status</th><th>Mensagem</th><th>Data</th></tr></thead><tbody>";
      rel.forEach(r=>{
        html += `<tr>
          <td>${r.nome}</td>
          <td>${r.email}</td>
          <td>${r.cil}</td>
          <td>${r.status}</td>
          <td class="small muted">${r.mensagem}</td>
          <td>${new Date(r.data_envio).toLocaleString()}</td>
        </tr>`;
      });
      html+="</tbody></table>";

      tabelaRelatorio.innerHTML = html;
    }

    function exportarCSV(){
      const rel = carregar(DB_KEYS.REL);
      if(!rel.length) return alert("Sem dados");

      const rows=[["nome","email","cil","status","mensagem","data_envio"]];
      rel.forEach(r=>{
        rows.push([
          r.nome,r.email,r.cil,r.status,
          `"${r.mensagem.replace(/"/g,'""')}"`,
          r.data_envio
        ]);
      });

      const csv = rows.map(r=>r.join(",")).join("\n");
      const blob = new Blob([csv],{type:"text/csv"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download="relatorio_envio.csv";
      a.click();
    }

    init();
  </script>
</body>
</html>
